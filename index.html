<html>
<head>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
</head>
<body>
    <a-scene vr-mode-ui="enabled: true">
        <!-- Ground -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="20" height="50" color="#7BC8A4"></a-plane>
        
        <!-- Avatar -->
        <a-box id="player" position="0 1 0" color="blue" width="1" height="1" depth="1"></a-box>
        
        <!-- Start Screen -->
        <a-text id="startScreen" position="0 4 -5" align="center" color="white" 
                value="ENDLESS RUNNER VR\n\nVR Controls:\nA Button = Jump\nGrip Button = Duck\n\nPress B Button to START!"
                scale="1.5 1.5 1.5"></a-text>
        
        <!-- Auto-restart message (appears when game ends) -->
        <a-text id="autoRestartMessage" position="0 1 -5" align="center" color="yellow" 
                value="Auto-restarting in 3 seconds..." scale="1.5 1.5 1.5" visible="false"></a-text>
        
        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 10 0" color="#ffffff"></a-light>
        
        <!-- VR Camera with controllers -->
        <a-entity id="cameraRig" position="0 5 10">
            <a-camera look-at="#player"></a-camera>
            <a-entity id="leftHand" 
                      hand-controls="hand: left; handModelStyle: lowPoly; color: #ffcccc"
                      laser-controls raycaster="objects: .clickable"></a-entity>
            <a-entity id="rightHand" 
                      hand-controls="hand: right; handModelStyle: lowPoly; color: #ffcccc"
                      laser-controls raycaster="objects: .clickable"></a-entity>
        </a-entity>
    </a-scene>

    <script>
        // Get elements
        const player = document.querySelector('#player');
        const startScreen = document.querySelector('#startScreen');
        const autoRestartMessage = document.querySelector('#autoRestartMessage');
        
        // Game state variables
        let gameStarted = false;
        let gameRunning = false;
        let score = 0;
        let gameTime = 0;
        let lastObstacleCount = 0;
        let autoRestartTimer = 0;
        let isAutoRestarting = false;
        
        // Player variables
        let playerZ = 0;
        let playerY = 1;
        let isJumping = false;
        let isDucking = false;
        let jumpSpeed = 0;
        const jumpPower = 0.3;
        const gravity = 0.02;
        const moveSpeed = 0.05;
        
        // Obstacle system
        let obstacles = [];
        let obstacleSpawnTimer = 0;
        const obstacleSpawnRate = 120;

        // Start the game
        function startGame() {
            gameStarted = true;
            gameRunning = true;
            
            // Hide start screen
            startScreen.setAttribute('visible', 'false');
            
            // Create score display
            createScoreDisplay();
        }

        // Move player forward
        function movePlayer() {
            playerZ -= moveSpeed;
        }

        // Update player movement (jumping/ducking)
        function updatePlayer() {
            if (isJumping) {
                playerY += jumpSpeed;
                jumpSpeed -= gravity;
                
                if (playerY <= 1) {
                    playerY = 1;
                    isJumping = false;
                    jumpSpeed = 0;
                }
            }
            
            if (isDucking) {
                playerY = 0.5;
            } else if (!isJumping) {
                playerY = 1;
            }
            
            player.setAttribute('position', `0 ${playerY} ${playerZ}`);
        }

        // Create obstacle
        function createObstacle() {
            const obstacle = document.createElement('a-box');
            obstacle.setAttribute('position', `${Math.random() * 4 - 2} 1 -20`);
            obstacle.setAttribute('color', 'red');
            obstacle.setAttribute('width', '1');
            obstacle.setAttribute('height', '2');
            obstacle.setAttribute('depth', '1');
            obstacle.setAttribute('class', 'obstacle');
            
            document.querySelector('a-scene').appendChild(obstacle);
            obstacles.push({
                element: obstacle,
                z: -20
            });
        }

        // Move obstacles toward player
        function updateObstacles() {
            for (let i = obstacles.length - 1; i >= 0; i--) {
                const obstacle = obstacles[i];
                obstacle.z += 0.1;
                
                const currentPos = obstacle.element.getAttribute('position');
                obstacle.element.setAttribute('position', `${currentPos.x} 1 ${obstacle.z}`);
                
                if (obstacle.z > 5) {
                    obstacle.element.remove();
                    obstacles.splice(i, 1);
                }
            }
        }

        // Collision detection
        function checkCollisions() {
            for (let obstacle of obstacles) {
                const playerPos = player.getAttribute('position');
                const obstaclePos = obstacle.element.getAttribute('position');
                
                const distance = Math.sqrt(
                    Math.pow(playerPos.x - obstaclePos.x, 2) + 
                    Math.pow(playerPos.z - obstaclePos.z, 2)
                );
                
                const heightDiff = Math.abs(playerPos.y - obstaclePos.y);
                
                if (distance < 1 && heightDiff < 1) {
                    gameOver();
                    return true;
                }
            }
            return false;
        }

        // Create score display
        function createScoreDisplay() {
            const scoreDisplay = document.createElement('a-text');
            scoreDisplay.setAttribute('id', 'scoreDisplay');
            scoreDisplay.setAttribute('position', '-8 8 -10');
            scoreDisplay.setAttribute('color', 'white');
            scoreDisplay.setAttribute('value', 'Score: 0\nTime: 30');
            scoreDisplay.setAttribute('scale', '1.5 1.5 1.5');
            
            document.querySelector('a-scene').appendChild(scoreDisplay);
        }

        // Update score and timer
        function updateScore() {
            gameTime++;
            
            if (gameTime % 30 === 0) {
                score += 10;
            }
            
            if (obstacles.length < lastObstacleCount) {
                score += 50;
            }
            lastObstacleCount = obstacles.length;
            
            const timeLeft = Math.max(0, 30 - Math.floor(gameTime / 60));
            const scoreDisplay = document.querySelector('#scoreDisplay');
            if (scoreDisplay) {
                scoreDisplay.setAttribute('value', `Score: ${score}\nTime: ${timeLeft}`);
            }
            
            if (gameTime >= 1800) {
                youWin();
            }
        }

        // Game over screen with auto-restart
        function gameOver() {
            gameRunning = false;
            isAutoRestarting = true;
            autoRestartTimer = 180; // 3 seconds at 60fps
            
            const gameOverScreen = document.createElement('a-text');
            gameOverScreen.setAttribute('id', 'gameOverScreen');
            gameOverScreen.setAttribute('position', '0 4 -5');
            gameOverScreen.setAttribute('align', 'center');
            gameOverScreen.setAttribute('color', 'red');
            gameOverScreen.setAttribute('value', `YOU DIED!\nScore: ${score}`);
            gameOverScreen.setAttribute('scale', '2 2 2');
            
            document.querySelector('a-scene').appendChild(gameOverScreen);
            
            // Show auto-restart message
            autoRestartMessage.setAttribute('visible', 'true');
        }

        // Win screen with auto-restart
        function youWin() {
            gameRunning = false;
            isAutoRestarting = true;
            autoRestartTimer = 180; // 3 seconds at 60fps
            
            const winScreen = document.createElement('a-text');
            winScreen.setAttribute('id', 'winScreen');
            winScreen.setAttribute('position', '0 4 -5');
            winScreen.setAttribute('align', 'center');
            winScreen.setAttribute('color', 'green');
            winScreen.setAttribute('value', `YOU WIN!\nFinal Score: ${score}`);
            winScreen.setAttribute('scale', '2 2 2');
            
            document.querySelector('a-scene').appendChild(winScreen);
            
            // Show auto-restart message
            autoRestartMessage.setAttribute('visible', 'true');
        }

        // Auto-restart countdown
        function updateAutoRestart() {
            if (isAutoRestarting) {
                autoRestartTimer--;
                
                // Update countdown message
                const secondsLeft = Math.ceil(autoRestartTimer / 60);
                autoRestartMessage.setAttribute('value', `Auto-restarting in ${secondsLeft} seconds...`);
                
                // Restart when timer reaches 0
                if (autoRestartTimer <= 0) {
                    restartGame();
                }
            }
        }

        // Restart game (goes back to start screen)
        function restartGame() {
            const gameOverScreen = document.querySelector('#gameOverScreen');
            const winScreen = document.querySelector('#winScreen');
            const scoreDisplay = document.querySelector('#scoreDisplay');
            
            if (gameOverScreen) gameOverScreen.remove();
            if (winScreen) winScreen.remove();
            if (scoreDisplay) scoreDisplay.remove();
            
            // Hide auto-restart message
            autoRestartMessage.setAttribute('visible', 'false');
            
            // Show start screen again
            startScreen.setAttribute('visible', 'true');
            
            // Reset auto-restart state
            isAutoRestarting = false;
            autoRestartTimer = 0;
            
            // PROPERLY RESET AVATAR POSITION
            playerZ = 0;
            playerY = 1;
            player.setAttribute('position', '0 1 0');
            
            // Reset player states
            isJumping = false;
            isDucking = false;
            jumpSpeed = 0;
            
            // Clear all obstacles
            obstacles.forEach(obstacle => obstacle.element.remove());
            obstacles = [];
            
            // Reset game state to waiting for start
            gameStarted = false;
            gameRunning = false;
            score = 0;
            gameTime = 0;
            obstacleSpawnTimer = 0;
            lastObstacleCount = 0;
        }

        // VR Controller events
        document.addEventListener('DOMContentLoaded', () => {
            // B Button to start game
            document.addEventListener('bbuttondown', (event) => {
                if (!gameStarted) {
                    startGame();
                }
            });
            
            // A Button for jump
            document.addEventListener('abuttondown', (event) => {
                if (gameRunning && !isJumping) {
                    isJumping = true;
                    jumpSpeed = jumpPower;
                }
            });
            
            // Grip button for duck
            document.addEventListener('gripdown', (event) => {
                if (gameRunning) {
                    isDucking = true;
                }
            });
            
            document.addEventListener('gripup', (event) => {
                isDucking = false;
            });
        });

        // Main game loop
        function gameLoop() {
            if (isAutoRestarting) {
                updateAutoRestart();
            }
            
            if (!gameRunning) {
                requestAnimationFrame(gameLoop);
                return;
            }
            
            movePlayer();
            updatePlayer();
            updateScore();
            
            obstacleSpawnTimer++;
            if (obstacleSpawnTimer >= obstacleSpawnRate) {
                createObstacle();
                obstacleSpawnTimer = 0;
            }
            
            updateObstacles();
            checkCollisions();
            requestAnimationFrame(gameLoop);
        }

        // Start the game loop when scene loads
        document.querySelector('a-scene').addEventListener('loaded', () => {
            gameLoop();
        });
    </script>
</body>
</html>







