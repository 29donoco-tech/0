<!DOCTYPE html>
<html>
<head>
    <title>Avoid the Obstacles - VR Game</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>
<body>
    <a-scene background="color: #87CEEB" vr-mode-ui="enabled: false">
        <!-- Assets -->
        <a-assets>
            <a-mixin id="obstacle" 
                     geometry="primitive: box; width: 2; height: 2; depth: 1" 
                     material="color: red"
                     animation="property: position; to: 0 0 10; dur: 3000; loop: true">
            </a-mixin>
        </a-assets>

        <!-- Player Camera -->
        <a-camera id="player" 
                  position="0 1.6 0" 
                  wasd-controls="enabled: false"
                  look-controls="enabled: true">
            <!-- Crosshair for clicking -->
            <a-cursor geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                      material="color: white; shader: flat"
                      position="0 0 -1">
            </a-cursor>
        </a-camera>

        <!-- Much Longer Ground Plane -->
        <a-plane position="0 0 0" 
                 rotation="-90 0 0" 
                 width="15" 
                 height="500" 
                 color="#4CC3D9"
                 material="side: double">
        </a-plane>

        <!-- Side Walls for Visual Boundaries -->
        <a-plane position="-7.5 2 0" 
                 rotation="0 0 0" 
                 width="500" 
                 height="4" 
                 color="#2E8B57"
                 material="side: double">
        </a-plane>
        
        <a-plane position="7.5 2 0" 
                 rotation="0 0 0" 
                 width="500" 
                 height="4" 
                 color="#2E8B57"
                 material="side: double">
        </a-plane>

        <!-- Obstacles (will be created by JavaScript) -->
        <a-entity id="obstacle-container"></a-entity>

        <!-- Enhanced UI Elements -->
        <a-text id="score-text" 
                position="-4 3.5 -5" 
                value="Score: 0" 
                color="white" 
                scale="2 2 2"
                font="dejavu">
        </a-text>

        <a-text id="high-score-text" 
                position="-4 3 -5" 
                value="High Score: 0" 
                color="yellow" 
                scale="1.5 1.5 1.5"
                font="dejavu">
        </a-text>

        <a-text id="distance-text" 
                position="2 3.5 -5" 
                value="Distance: 0m" 
                color="cyan" 
                scale="2 2 2"
                font="dejavu">
        </a-text>

        <a-text id="speed-text" 
                position="2 3 -5" 
                value="Speed: 1x" 
                color="orange" 
                scale="1.5 1.5 1.5"
                font="dejavu">
        </a-text>

        <a-text id="instructions" 
                position="0 2 -5" 
                value="Click to Jump/Duck!\nAvoid the red obstacles!" 
                color="yellow" 
                scale="1.5 1.5 1.5" 
                align="center"
                font="dejavu">
        </a-text>

        <!-- Game Over Screen (hidden initially) -->
        <a-text id="game-over" 
                position="0 0 -5" 
                value="GAME OVER!\nClick to Restart" 
                color="red" 
                scale="3 3 3" 
                align="center" 
                visible="false"
                font="dejavu">
        </a-text>

        <!-- Score Popup for bonus points -->
        <a-text id="score-popup" 
                position="0 1 -3" 
                value="+10" 
                color="lime" 
                scale="2 2 2" 
                align="center" 
                visible="false"
                font="dejavu">
        </a-text>
    </a-scene>

    <script>
        // Game variables
        let gameRunning = true;
        let score = 0;
        let highScore = localStorage.getItem('highScore') || 0;
        let distance = 0;
        let playerY = 1.6; // Normal height
        let isJumping = false;
        let obstacles = [];
        let obstacleSpeed = 0.05;
        let spawnRate = 0.02;
        let speedMultiplier = 1;

        // Get game elements
        const player = document.querySelector('#player');
        const obstacleContainer = document.querySelector('#obstacle-container');
        const scoreText = document.querySelector('#score-text');
        const highScoreText = document.querySelector('#high-score-text');
        const distanceText = document.querySelector('#distance-text');
        const speedText = document.querySelector('#speed-text');
        const gameOverText = document.querySelector('#game-over');
        const instructions = document.querySelector('#instructions');
        const scorePopup = document.querySelector('#score-popup');

        // Initialize UI
        highScoreText.setAttribute('value', `High Score: ${highScore}`);

        // Player movement - automatic forward motion
        function movePlayer() {
            if (!gameRunning) return;
            
            const currentPos = player.getAttribute('position');
            const moveDistance = 0.1 * speedMultiplier;
            
            player.setAttribute('position', {
                x: currentPos.x,
                y: playerY,
                z: currentPos.z - moveDistance // Move forward automatically
            });
            
            // Update distance traveled
            distance += moveDistance;
            distanceText.setAttribute('value', `Distance: ${Math.floor(distance)}m`);
            
            // Distance bonus points
            if (Math.floor(distance) % 50 === 0 && Math.floor(distance) > 0) {
                addScore(5, "Distance Bonus!");
            }
        }

        // Enhanced scoring system
        function addScore(points, reason = "") {
            score += points;
            scoreText.setAttribute('value', `Score: ${score}`);
            
            // Show score popup
            if (reason) {
                showScorePopup(`+${points}`, reason);
            }
            
            // Check for new high score
            if (score > highScore) {
                highScore = score;
                highScoreText.setAttribute('value', `High Score: ${highScore}`);
                localStorage.setItem('highScore', highScore);
            }
        }

        // Show floating score popup
        function showScorePopup(scoreText, reason) {
            scorePopup.setAttribute('value', `${scoreText}\n${reason}`);
            scorePopup.setAttribute('visible', 'true');
            scorePopup.setAttribute('position', '0 1 -3');
            
            // Animate popup
            scorePopup.setAttribute('animation', 
                'property: position; to: 0 2.5 -3; dur: 1000; easing: easeOutQuad');
            
            setTimeout(() => {
                scorePopup.setAttribute('visible', 'false');
            }, 1000);
        }

        // Jump/Duck mechanics
        function handleClick() {
            if (!gameRunning) {
                // Restart game
                restartGame();
                return;
            }

            if (!isJumping) {
                isJumping = true;
                
                // Alternate between jump (up) and duck (down)
                if (playerY === 1.6) {
                    // Jump
                    playerY = 3.0;
                    addScore(1, "Jump!");
                    setTimeout(() => {
                        playerY = 1.6;
                        isJumping = false;
                    }, 500);
                }
            }
        }

        // Create obstacles
        function createObstacle() {
            const obstacle = document.createElement('a-box');
            const randomX = (Math.random() - 0.5) * 10; // Wider spread for longer plane
            const randomY = Math.random() > 0.5 ? 1 : 2.5; // Low or high obstacle
            
            obstacle.setAttribute('position', `${randomX} ${randomY} -30`);
            obstacle.setAttribute('width', '2');
            obstacle.setAttribute('height', '2');
            obstacle.setAttribute('depth', '1');
            obstacle.setAttribute('color', 'red');
            obstacle.setAttribute('class', 'obstacle');
            
            obstacleContainer.appendChild(obstacle);
            obstacles.push({
                element: obstacle,
                x: randomX,
                y: randomY,
                z: -30
            });
        }

        // Move obstacles toward player
        function moveObstacles() {
            if (!gameRunning) return;
            
            obstacles.forEach((obstacle, index) => {
                obstacle.z += obstacleSpeed * speedMultiplier;
                obstacle.element.setAttribute('position', 
                    `${obstacle.x} ${obstacle.y} ${obstacle.z}`);
                
                // Remove obstacles that have passed the player
                if (obstacle.z > 10) {
                    obstacle.element.remove();
                    obstacles.splice(index, 1);
                    addScore(15, "Obstacle Avoided!");
                    
                    // Increase difficulty and speed
                    if (score % 200 === 0 && score > 0) {
                        speedMultiplier += 0.2;
                        obstacleSpeed += 0.01;
                        spawnRate += 0.003;
                        speedText.setAttribute('value', `Speed: ${speedMultiplier.toFixed(1)}x`);
                        showScorePopup("+50", "Speed Boost!");
                        addScore(50, "");
                    }
                }
            });
        }

        // Collision detection
        function checkCollisions() {
            if (!gameRunning) return;
            
            const playerPos = player.getAttribute('position');
            
            obstacles.forEach(obstacle => {
                const distance = Math.sqrt(
                    Math.pow(playerPos.x - obstacle.x, 2) +
                    Math.pow(playerPos.y - obstacle.y, 2) +
                    Math.pow(playerPos.z - obstacle.z, 2)
                );
                
                // Collision detected
                if (distance < 1.5) {
                    gameOver();
                }
            });
        }

        // Game over
        function gameOver() {
            gameRunning = false;
            gameOverText.setAttribute('visible', 'true');
            gameOverText.setAttribute('value', 
                `GAME OVER!\nFinal Score: ${score}\nDistance: ${Math.floor(distance)}m\nClick to Restart`);
            instructions.setAttribute('visible', 'false');
        }

        // Restart game
        function restartGame() {
            gameRunning = true;
            score = 0;
            distance = 0;
            playerY = 1.6;
            isJumping = false;
            obstacleSpeed = 0.05;
            spawnRate = 0.02;
            speedMultiplier = 1;
            
            // Reset UI
            scoreText.setAttribute('value', 'Score: 0');
            distanceText.setAttribute('value', 'Distance: 0m');
            speedText.setAttribute('value', 'Speed: 1x');
            gameOverText.setAttribute('visible', 'false');
            instructions.setAttribute('visible', 'true');
            scorePopup.setAttribute('visible', 'false');
            
            // Clear obstacles
            obstacles.forEach(obstacle => obstacle.element.remove());
            obstacles = [];
            
            // Reset player position
            player.setAttribute('position', '0 1.6 0');
        }

        // Game loop
        function gameLoop() {
            if (gameRunning) {
                movePlayer();
                moveObstacles();
                checkCollisions();
                
                // Spawn new obstacles
                if (Math.random() < spawnRate) {
                    createObstacle();
                }
            }
            
            requestAnimationFrame(gameLoop);
        }

        // Event listeners
        document.addEventListener('click', handleClick);
        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space') {
                event.preventDefault();
                handleClick();
            }
        });

        // Start the game
        setTimeout(() => {
            gameLoop();
        }, 1000);
    </script>
</body>
</html>

